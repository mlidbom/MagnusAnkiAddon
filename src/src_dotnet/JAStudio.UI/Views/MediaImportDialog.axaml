<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:JAStudio.UI.ViewModels"
        x:Class="JAStudio.UI.Views.MediaImportDialog"
        x:DataType="vm:MediaImportDialogViewModel"
        Title="Media Import"
        Width="950" Height="700"
        MinWidth="700" MinHeight="500"
        Design.Width="950" Design.Height="700"
        WindowStartupLocation="Manual">

    <Design.DataContext>
        <vm:MediaImportDialogViewModel />
    </Design.DataContext>

    <LayoutTransformControl>
        <LayoutTransformControl.LayoutTransform>
            <ScaleTransform ScaleX="0.85" ScaleY="0.85" />
        </LayoutTransformControl.LayoutTransform>
        <DockPanel Margin="10">
            <!-- Button bar at bottom -->
            <StackPanel DockPanel.Dock="Bottom" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,10,0,0" Spacing="10">
                <Button Content="Scan" Command="{Binding ScanCommand}" Width="80" />
                <Button Content="Analyze" Command="{Binding AnalyzeCommand}" Width="80" />
                <Button Content="Import" Command="{Binding ImportCommand}" IsEnabled="{Binding HasPlan}" Width="80" />
                <Button Content="Save Rules" Command="{Binding SaveRulesCommand}" Width="90" />
                <Button Content="Close" Command="{Binding CloseCommand}" Width="80" />
            </StackPanel>

            <!-- Status bar -->
            <TextBlock DockPanel.Dock="Bottom" Text="{Binding StatusText}" Margin="0,5,0,0" FontStyle="Italic" />

            <!-- Plan summary -->
            <Border DockPanel.Dock="Bottom" BorderBrush="Gray" BorderThickness="1" CornerRadius="4" Padding="10" Margin="0,5,0,0"
                    IsVisible="{Binding HasPlan}">
                <Grid ColumnDefinitions="Auto,Auto,30,Auto,Auto,30,Auto,Auto" RowDefinitions="Auto">
                    <TextBlock Grid.Column="0" Text="To import:" FontWeight="SemiBold" Margin="0,0,5,0" />
                    <TextBlock Grid.Column="1" Text="{Binding FilesToImportCount}" />
                    <TextBlock Grid.Column="3" Text="Already stored:" FontWeight="SemiBold" Margin="0,0,5,0" />
                    <TextBlock Grid.Column="4" Text="{Binding AlreadyStoredCount}" />
                    <TextBlock Grid.Column="6" Text="Missing from Anki:" FontWeight="SemiBold" Margin="0,0,5,0" />
                    <TextBlock Grid.Column="7" Text="{Binding MissingCount}" />
                </Grid>
            </Border>

            <!-- Tabs -->
            <TabControl>
                <!-- Vocab Tab -->
                <TabItem Header="Vocab">
                    <DockPanel Margin="5">
                        <StackPanel DockPanel.Dock="Top" Spacing="3">
                            <TextBlock Text="Import Rules" FontWeight="SemiBold" FontSize="14" Margin="0,0,0,5" />
                            <ItemsControl ItemsSource="{Binding VocabTab.Rules}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate x:DataType="vm:EditableImportRule">
                                        <Grid ColumnDefinitions="*,120,*,120,Auto,Auto" Margin="0,2">
                                            <TextBox Grid.Column="0" Watermark="Source tag prefix" Text="{Binding SourceTagPrefix}" Margin="0,0,5,0" />
                                            <ComboBox Grid.Column="1" ItemsSource="{x:Static vm:MediaImportDialogViewModel.VocabFieldNames}" SelectedItem="{Binding SelectedField}" Margin="0,0,5,0" />
                                            <TextBox Grid.Column="2" Watermark="Target directory" Text="{Binding TargetDirectory}" Margin="0,0,5,0" />
                                            <ComboBox Grid.Column="3" ItemsSource="{x:Static vm:EditableImportRule.CopyrightOptions}" SelectedItem="{Binding SelectedCopyright}" Margin="0,0,5,0" />
                                            <TextBlock Grid.Column="4" Text="{Binding MatchCount, StringFormat='({0} files)'}" VerticalAlignment="Center" Margin="0,0,10,0" MinWidth="80" />
                                            <Button Grid.Column="5" Content="X"
                                                    Command="{Binding RemoveSelfCommand}"
                                                    Width="30" />
                                        </Grid>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                            <Button Content="+ Add Rule" Command="{Binding AddVocabRuleCommand}" HorizontalAlignment="Left" Margin="0,3,0,0" />
                        </StackPanel>

                        <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Margin="0,10,0,5" Spacing="20">
                            <TextBlock FontWeight="SemiBold">
                                <Run Text="Mapped: " /><Run Text="{Binding VocabTab.TotalMappedCount}" />
                            </TextBlock>
                            <TextBlock FontWeight="SemiBold">
                                <Run Text="Unmapped: " /><Run Text="{Binding VocabTab.TotalUnmappedCount}" />
                            </TextBlock>
                        </StackPanel>

                        <DataGrid ItemsSource="{Binding VocabTab.UnmappedGroups}" IsReadOnly="True"
                                  AutoGenerateColumns="False">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Source" Binding="{Binding SourcePrefix}" Width="*" />
                                <DataGridTextColumn Header="Field" Binding="{Binding FieldName}" Width="120" />
                                <DataGridTextColumn Header="Files" Binding="{Binding FileCount}" Width="80" />
                            </DataGrid.Columns>
                        </DataGrid>
                    </DockPanel>
                </TabItem>

                <!-- Sentence Tab -->
                <TabItem Header="Sentences">
                    <DockPanel Margin="5">
                        <StackPanel DockPanel.Dock="Top" Spacing="3">
                            <TextBlock Text="Import Rules" FontWeight="SemiBold" FontSize="14" Margin="0,0,0,5" />
                            <ItemsControl ItemsSource="{Binding SentenceTab.Rules}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate x:DataType="vm:EditableImportRule">
                                        <Grid ColumnDefinitions="*,120,*,120,Auto,Auto" Margin="0,2">
                                            <TextBox Grid.Column="0" Watermark="Source tag prefix" Text="{Binding SourceTagPrefix}" Margin="0,0,5,0" />
                                            <ComboBox Grid.Column="1" ItemsSource="{x:Static vm:MediaImportDialogViewModel.SentenceFieldNames}" SelectedItem="{Binding SelectedField}" Margin="0,0,5,0" />
                                            <TextBox Grid.Column="2" Watermark="Target directory" Text="{Binding TargetDirectory}" Margin="0,0,5,0" />
                                            <ComboBox Grid.Column="3" ItemsSource="{x:Static vm:EditableImportRule.CopyrightOptions}" SelectedItem="{Binding SelectedCopyright}" Margin="0,0,5,0" />
                                            <TextBlock Grid.Column="4" Text="{Binding MatchCount, StringFormat='({0} files)'}" VerticalAlignment="Center" Margin="0,0,10,0" MinWidth="80" />
                                            <Button Grid.Column="5" Content="X"
                                                    Command="{Binding RemoveSelfCommand}"
                                                    Width="30" />
                                        </Grid>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                            <Button Content="+ Add Rule" Command="{Binding AddSentenceRuleCommand}" HorizontalAlignment="Left" Margin="0,3,0,0" />
                        </StackPanel>

                        <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Margin="0,10,0,5" Spacing="20">
                            <TextBlock FontWeight="SemiBold">
                                <Run Text="Mapped: " /><Run Text="{Binding SentenceTab.TotalMappedCount}" />
                            </TextBlock>
                            <TextBlock FontWeight="SemiBold">
                                <Run Text="Unmapped: " /><Run Text="{Binding SentenceTab.TotalUnmappedCount}" />
                            </TextBlock>
                        </StackPanel>

                        <DataGrid ItemsSource="{Binding SentenceTab.UnmappedGroups}" IsReadOnly="True"
                                  AutoGenerateColumns="False">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Source" Binding="{Binding SourcePrefix}" Width="*" />
                                <DataGridTextColumn Header="Field" Binding="{Binding FieldName}" Width="120" />
                                <DataGridTextColumn Header="Files" Binding="{Binding FileCount}" Width="80" />
                            </DataGrid.Columns>
                        </DataGrid>
                    </DockPanel>
                </TabItem>

                <!-- Kanji Tab -->
                <TabItem Header="Kanji">
                    <DockPanel Margin="5">
                        <StackPanel DockPanel.Dock="Top" Spacing="3">
                            <TextBlock Text="Import Rules" FontWeight="SemiBold" FontSize="14" Margin="0,0,0,5" />
                            <ItemsControl ItemsSource="{Binding KanjiTab.Rules}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate x:DataType="vm:EditableImportRule">
                                        <Grid ColumnDefinitions="*,120,*,120,Auto,Auto" Margin="0,2">
                                            <TextBox Grid.Column="0" Watermark="Source tag prefix" Text="{Binding SourceTagPrefix}" Margin="0,0,5,0" />
                                            <ComboBox Grid.Column="1" ItemsSource="{x:Static vm:MediaImportDialogViewModel.KanjiFieldNames}" SelectedItem="{Binding SelectedField}" Margin="0,0,5,0" />
                                            <TextBox Grid.Column="2" Watermark="Target directory" Text="{Binding TargetDirectory}" Margin="0,0,5,0" />
                                            <ComboBox Grid.Column="3" ItemsSource="{x:Static vm:EditableImportRule.CopyrightOptions}" SelectedItem="{Binding SelectedCopyright}" Margin="0,0,5,0" />
                                            <TextBlock Grid.Column="4" Text="{Binding MatchCount, StringFormat='({0} files)'}" VerticalAlignment="Center" Margin="0,0,10,0" MinWidth="80" />
                                            <Button Grid.Column="5" Content="X"
                                                    Command="{Binding RemoveSelfCommand}"
                                                    Width="30" />
                                        </Grid>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                            <Button Content="+ Add Rule" Command="{Binding AddKanjiRuleCommand}" HorizontalAlignment="Left" Margin="0,3,0,0" />
                        </StackPanel>

                        <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Margin="0,10,0,5" Spacing="20">
                            <TextBlock FontWeight="SemiBold">
                                <Run Text="Mapped: " /><Run Text="{Binding KanjiTab.TotalMappedCount}" />
                            </TextBlock>
                            <TextBlock FontWeight="SemiBold">
                                <Run Text="Unmapped: " /><Run Text="{Binding KanjiTab.TotalUnmappedCount}" />
                            </TextBlock>
                        </StackPanel>

                        <DataGrid ItemsSource="{Binding KanjiTab.UnmappedGroups}" IsReadOnly="True"
                                  AutoGenerateColumns="False">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Source" Binding="{Binding SourcePrefix}" Width="*" />
                                <DataGridTextColumn Header="Field" Binding="{Binding FieldName}" Width="120" />
                                <DataGridTextColumn Header="Files" Binding="{Binding FileCount}" Width="80" />
                            </DataGrid.Columns>
                        </DataGrid>
                    </DockPanel>
                </TabItem>
            </TabControl>
        </DockPanel>
    </LayoutTransformControl>
</Window>
